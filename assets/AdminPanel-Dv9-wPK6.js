import{r as t,j as e}from"./index-QdsocXSw.js";function K({onLogin:x}){const[c,b]=t.useState(""),[g,N]=t.useState(""),[k,f]=t.useState(""),v=async s=>{s.preventDefault(),f("");const o=await fetch("https://portifolio-api-mu.vercel.app/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario:c,senha:g})});if(o.ok){const{token:i}=await o.json();sessionStorage.setItem("admin_token",i),x()}else f("Usuário ou senha inválidos")};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background-light dark:bg-background-dark",children:e.jsxs("form",{onSubmit:v,className:"bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-8 min-w-[320px] flex flex-col gap-5",children:[e.jsx("h2",{className:"text-center text-primary-light dark:text-primary-dark font-bold text-2xl mb-2",children:"Painel Admin"}),e.jsx("label",{className:"font-medium text-gray-600 dark:text-gray-300",children:"Usuário"}),e.jsx("input",{placeholder:"Digite seu usuário",value:c,onChange:s=>b(s.target.value),required:!0,className:"p-2 rounded-lg border border-border-light dark:border-border-dark text-base bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark"}),e.jsx("label",{className:"font-medium text-gray-600 dark:text-gray-300",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Digite sua senha",value:g,onChange:s=>N(s.target.value),required:!0,className:"p-2 rounded-lg border border-border-light dark:border-border-dark text-base bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark"}),e.jsx("button",{type:"submit",className:"mt-2 bg-primary-light dark:bg-primary-dark text-white rounded-lg py-3 font-semibold text-lg cursor-pointer shadow transition hover:bg-primary-dark dark:hover:bg-primary-light",children:"Entrar"}),k&&e.jsx("div",{className:"text-red-600 text-center mt-2",children:k})]})})}function W(){const[x,c]=t.useState([]),[b,g]=t.useState([]),[N,k]=t.useState(!0),[f,v]=t.useState(()=>!!sessionStorage.getItem("admin_token")),[s,o]=t.useState({id:"",title:"",deadline:"",progress:0,category:""}),[i,n]=t.useState({id:"",title:"",date:"",issuer:"",progress:0,externalUrl:""}),[p,w]=t.useState(null),[m,C]=t.useState(null),[T,y]=t.useState(""),[P,q]=t.useState([]),[S,$]=t.useState(!1),[G,D]=t.useState(!1),[A,E]=t.useState(""),z=async()=>{D(!0),E("");try{const r=await fetch("https://portifolio-api-mu.vercel.app/api/admin-logs",{credentials:"include"});if(r.ok){const a=await r.json();q(a)}else E("Acesso negado ou erro ao buscar logs.")}catch{E("Erro de conexão ao buscar logs.")}D(!1)};t.useEffect(()=>{Promise.all([fetch("https://portifolio-api-mu.vercel.app/api/goals",{credentials:"include"}).then(r=>r.json()),fetch("https://portifolio-api-mu.vercel.app/api/certificates",{credentials:"include"}).then(r=>r.json())]).then(([r,a])=>{c(Array.isArray(r)?r:r.goals||[]),g(Array.isArray(a)?a:a.certificates||[]),k(!1)})},[]);const O=async r=>{r.preventDefault();const a=sessionStorage.getItem("admin_token");if(p){const d={...s,id:p};(await fetch(`https://portifolio-api-mu.vercel.app/api/goals/${p}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(d),credentials:"include"})).ok&&(c(x.map(l=>l.id===p?d:l)),o({id:"",title:"",deadline:"",progress:0,category:""}),w(null))}else{const d={...s,id:crypto.randomUUID()};(await fetch("https://portifolio-api-mu.vercel.app/api/goals",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(d),credentials:"include"})).ok&&(c([...x,d]),o({id:"",title:"",deadline:"",progress:0,category:""}))}},_=r=>{o(r),w(r.id)},[u,h]=t.useState(null),[I,j]=t.useState(""),B=async r=>{h({type:"goal",id:r})},R=async r=>{const a=sessionStorage.getItem("admin_token");await fetch(`https://portifolio-api-mu.vercel.app/api/goals/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`},credentials:"include"}),c(x.filter(d=>d.id!==r)),h(null),j("Goal removido com sucesso!"),setTimeout(()=>j(""),2500)},J=async r=>{r.preventDefault(),y("");const a=sessionStorage.getItem("admin_token");try{if(m){const d={...i,id:m};if((await fetch(`https://portifolio-api-mu.vercel.app/api/certificates/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(d),credentials:"include"})).ok){const l=await fetch("https://portifolio-api-mu.vercel.app/api/certificates",{credentials:"include"}).then(U=>U.json());g(Array.isArray(l)?l:l.certificates||[]),n({id:"",title:"",date:"",issuer:"",progress:0,externalUrl:""}),C(null)}else y("Erro ao editar certificado.")}else{const d={...i,id:crypto.randomUUID()};if((await fetch("https://portifolio-api-mu.vercel.app/api/certificates",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(d),credentials:"include"})).ok){const l=await fetch("https://portifolio-api-mu.vercel.app/api/certificates",{credentials:"include"}).then(U=>U.json());g(Array.isArray(l)?l:l.certificates||[]),n({id:"",title:"",date:"",issuer:"",progress:0,externalUrl:""})}else y("Erro ao adicionar certificado.")}}catch{y("Erro de conexão com o servidor.")}},F=r=>{n(r),C(r.id)},M=async r=>{h({type:"cert",id:r})},V=async r=>{const a=sessionStorage.getItem("admin_token");await fetch(`https://portifolio-api-mu.vercel.app/api/certificates/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`},credentials:"include"}),g(b.filter(d=>d.id!==r)),h(null),j("Certificado removido com sucesso!"),setTimeout(()=>j(""),2500)},H=()=>{sessionStorage.removeItem("admin_token"),window.location.reload()};return f?N?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background-light dark:bg-background-dark",children:e.jsx("div",{className:"text-primary-light dark:text-primary-dark text-2xl font-semibold",children:"Carregando..."})}):e.jsx("div",{className:"min-h-screen bg-background-light dark:bg-background-dark font-sans",children:e.jsxs("div",{className:"max-w-3xl mx-auto my-10 bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-8 flex flex-col gap-8",children:[e.jsxs("header",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-primary-light dark:text-primary-dark font-bold text-3xl m-0",children:"Painel Admin"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-primary-light dark:bg-primary-dark text-white rounded-lg px-4 py-2 font-semibold shadow transition hover:bg-primary-dark dark:hover:bg-primary-light",onClick:H,children:"Sair"}),e.jsx("button",{className:"bg-gray-200 dark:bg-gray-700 text-primary-light dark:text-primary-dark rounded-lg px-4 py-2 font-semibold",onClick:()=>{$(r=>!r),S||z()},children:S?"Ocultar Logs":"Ver Logs"})]})]}),S&&e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-primary-light dark:text-primary-dark font-semibold text-xl mb-3",children:"Logs Administrativos"}),G&&e.jsx("div",{className:"text-gray-500",children:"Carregando logs..."}),A&&e.jsx("div",{className:"text-red-600",children:A}),!G&&!A&&e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full text-xs text-left border border-border-light dark:border-border-dark",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"p-2",children:"Data/Hora"}),e.jsx("th",{className:"p-2",children:"IP"}),e.jsx("th",{className:"p-2",children:"Usuário"}),e.jsx("th",{className:"p-2",children:"Ação"}),e.jsx("th",{className:"p-2",children:"Detalhes"})]})}),e.jsx("tbody",{children:P.map((r,a)=>e.jsxs("tr",{className:"border-t border-border-light dark:border-border-dark",children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:new Date(r.timestamp).toLocaleString()}),e.jsx("td",{className:"p-2",children:r.ip}),e.jsx("td",{className:"p-2",children:r.usuario}),e.jsx("td",{className:"p-2",children:r.acao}),e.jsx("td",{className:"p-2",children:r.detalhes})]},a))})]})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-primary-light dark:text-primary-dark font-semibold text-xl mb-3",children:"Goals"}),e.jsxs("form",{className:"flex flex-wrap gap-3 mb-6",onSubmit:O,children:[e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Título",value:s.title,onChange:r=>o({...s,title:r.target.value}),required:!0,"aria-label":"Título do Goal"}),e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Deadline",value:s.deadline,onChange:r=>o({...s,deadline:r.target.value}),required:!0,"aria-label":"Deadline do Goal"}),e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Categoria",value:s.category,onChange:r=>o({...s,category:r.target.value}),required:!0,"aria-label":"Categoria do Goal"}),e.jsx("input",{type:"number",className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Progresso",value:s.progress,onChange:r=>o({...s,progress:Number(r.target.value)}),min:0,max:100,required:!0,"aria-label":"Progresso do Goal"}),e.jsx("button",{type:"submit",className:"bg-primary-light dark:bg-primary-dark text-white rounded-lg px-4 py-2 font-semibold transition hover:bg-primary-dark dark:hover:bg-primary-light",children:p?"Salvar Alteração":"Adicionar Goal"}),p&&e.jsx("button",{type:"button",className:"bg-gray-200 dark:bg-gray-700 text-primary-light dark:text-primary-dark rounded-lg px-4 py-2 font-semibold",onClick:()=>{w(null),o({id:"",title:"",deadline:"",progress:0,category:""})},children:"Cancelar"})]}),e.jsx("ul",{className:"space-y-2",children:x.map(r=>e.jsxs("li",{className:"bg-background-light dark:bg-gray-800 rounded-lg p-4 flex items-center justify-between gap-2 flex-wrap border border-border-light dark:border-border-dark",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-light dark:text-text-dark",children:r.title}),e.jsxs("span",{className:"text-primary-light dark:text-primary-dark font-semibold ml-2",children:[r.progress,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.category," | ",r.deadline]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B(r.id),className:"bg-red-600 text-white rounded px-3 py-1 font-medium",children:"Remover"}),e.jsx("button",{onClick:()=>_(r),className:"bg-primary-light dark:bg-primary-dark text-white rounded px-3 py-1 font-medium",children:"Editar"})]})]},r.id))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-primary-light dark:text-primary-dark font-semibold text-xl mb-3",children:"Certificados"}),e.jsxs("form",{className:"flex flex-wrap gap-3 mb-6",onSubmit:J,children:[e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Título",value:i.title,onChange:r=>n({...i,title:r.target.value}),required:!0,"aria-label":"Título do Certificado"}),e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Data",value:i.date,onChange:r=>n({...i,date:r.target.value}),required:!0,"aria-label":"Data do Certificado"}),e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Emissor",value:i.issuer,onChange:r=>n({...i,issuer:r.target.value}),required:!0,"aria-label":"Emissor do Certificado"}),e.jsx("input",{type:"number",className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"Progresso",value:i.progress,onChange:r=>n({...i,progress:Number(r.target.value)}),min:0,max:100,required:!0,"aria-label":"Progresso do Certificado"}),e.jsx("input",{className:"flex-1 min-w-[120px] p-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark text-base",placeholder:"URL externa",value:i.externalUrl,onChange:r=>n({...i,externalUrl:r.target.value}),"aria-label":"URL externa do Certificado"}),e.jsx("button",{type:"submit",className:"bg-primary-light dark:bg-primary-dark text-white rounded-lg px-4 py-2 font-semibold transition hover:bg-primary-dark dark:hover:bg-primary-light",children:m?"Salvar Alteração":"Adicionar Certificado"}),m&&e.jsx("button",{type:"button",className:"bg-gray-200 dark:bg-gray-700 text-primary-light dark:text-primary-dark rounded-lg px-4 py-2 font-semibold",onClick:()=>{C(null),n({id:"",title:"",date:"",issuer:"",progress:0,externalUrl:""})},children:"Cancelar"})]}),T&&e.jsx("div",{className:"text-red-600 mb-4",role:"alert",children:T}),e.jsx("ul",{className:"space-y-2",children:b.map(r=>e.jsxs("li",{className:"bg-background-light dark:bg-gray-800 rounded-lg p-4 flex items-center justify-between gap-2 flex-wrap border border-border-light dark:border-border-dark",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-light dark:text-text-dark",children:r.title}),e.jsx("span",{className:"text-primary-light dark:text-primary-dark font-semibold ml-2",children:r.issuer}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.date," | ",r.progress,"% ",r.externalUrl&&e.jsx("a",{href:r.externalUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary-light dark:text-primary-dark underline ml-2",children:"Ver"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(r.id),className:"bg-red-600 text-white rounded px-3 py-1 font-medium",children:"Remover"}),e.jsx("button",{onClick:()=>F(r),className:"bg-primary-light dark:bg-primary-dark text-white rounded px-3 py-1 font-medium",children:"Editar"})]})]},r.id))})]}),I&&e.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 bg-green-600 text-white px-6 py-2 rounded shadow-lg z-50 transition",children:I}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-lg flex flex-col gap-4 min-w-[300px]",children:[e.jsxs("span",{className:"text-lg text-gray-800 dark:text-gray-100 font-semibold",children:["Tem certeza que deseja remover ",u.type==="goal"?"este Goal":"este Certificado","?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded px-4 py-2 font-medium",onClick:()=>h(null),children:"Cancelar"}),e.jsx("button",{className:"bg-red-600 text-white rounded px-4 py-2 font-medium",onClick:()=>u.type==="goal"?R(u.id):V(u.id),children:"Remover"})]})]})})]})}):e.jsx(K,{onLogin:()=>v(!0)})}export{W as default};
